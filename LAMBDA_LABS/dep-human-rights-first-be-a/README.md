# Human Rights First A

You can find the deployed project at [Human Rights First](https://main.d2v2y4y91pkwd.amplifyapp.com/).

## Description
We partnered with Human Right First organization which is a non-profit advocacy group dedicated to ensuring justice for everyone based on the values that America was founded on. Human Rights First wanted a web application that was available for anyone to be able to see where incidents that involved police using force was occurring in America and how often that was occurring.

Based off of current events that labeled excessive police use of force in certain areas as outliers for the system in place. Human Rights First wanted a visual application that could show that these incidents were indeed outliers or if they were a product of a deeper rooted problem that should be addressed. 

Our team was tasked with improving visualizations of the previous codebase, making sure the data being rendered was coming from the backend API which retrieved data from the DS API and retrieving data points from multiple sources. 

### Key Features

- User can view incidents of police use of force and get more information on specific incidents
- User can search map based on type of force, location, and date
- User can view graphs which show which type of force is used the most and the locations where incidents occur


## Contributors 

## Team Project Lead
| [Jean Fraga](https://github.com/JeanFraga) |
| :---: |
| [<img src="https://ca.slack-edge.com/ESZCHB482-W012X6UK3Q9-d06d593b96c0-512" width="200" />](https://github.com/JeanFraga) |
| [ <img src="https://static.licdn.com/sc/h/al2o9zrvru7aqj8e1x2rzsrca" width="15"> ](https://www.linkedin.com/in/jeanfraga/) |

## Front End
| [Antonio Baez](https://github.com/tonomb) | [Ashley Bergsma](https://github.com/ashley-bergsma) | [Maryam Mosstoufi](https://github.com/MaryamMosstoufi) | 
| :---: | :---: | :---: |
| [<img src="https://ca.slack-edge.com/ESZCHB482-W012HMFH8E9-31ae71ede6a6-512" width="200" />](https://github.com/tonomb) | [<img src="https://ca.slack-edge.com/ESZCHB482-W0149MPSWE8-d8db5d0bd3c6-512" width="200" />](https://github.com/ashley-bergsma) | [<img src="https://ca.slack-edge.com/ESZCHB482-W0138Q5T9AL-32b57d34cfe5-512" width="200" />](https://github.com/MaryamMosstoufi) |
| [ <img src="https://static.licdn.com/sc/h/al2o9zrvru7aqj8e1x2rzsrca" width="15"> ](https://www.linkedin.com/in/antoniomtzb/)| [ <img src="https://static.licdn.com/sc/h/al2o9zrvru7aqj8e1x2rzsrca" width="15"> ](https://www.linkedin.com/in/ashleybergsma89/) |[ <img src="https://static.licdn.com/sc/h/al2o9zrvru7aqj8e1x2rzsrca" width="15"> ](https://www.linkedin.com/in/maryammosstoufi/) |

## Back End
| [Jessica Duell](https://github.com/jduell12) |
| :---: |                                                    
| [<img src="https://ca.slack-edge.com/ESZCHB482-W012XHX0325-7d8c97aaa89d-512" width="200" />](https://github.com/jduell12) |                                          
| [ <img src="https://static.licdn.com/sc/h/al2o9zrvru7aqj8e1x2rzsrca" width="15"> ](https://www.linkedin.com/in/jessicaduell/) |

## Data Science 
| [Ben Witter](https://github.com/Witterone) | [Terrence Malone](https://github.com/TerrenceAm22) |
| :---: | :---: |
| [<img src="https://ca.slack-edge.com/ESZCHB482-W012K5V3K43-e63794cbcf42-512" width = "200" />](https://github.com/Witterone) | [<img src="https://ca.slack-edge.com/ESZCHB482-W012JQ51H19-d8d45b8f0f6b-512" width = "200"/>](https://github.com/TerenceAM22)|
| [ <img src="https://static.licdn.com/sc/h/al2o9zrvru7aqj8e1x2rzsrca" width="15"> ](https://www.linkedin.com/in/benjamin-witter-a8980a50/) | [ <img src="https://static.licdn.com/sc/h/al2o9zrvru7aqj8e1x2rzsrca" width="15"> ](https://www.linkedin.com/in/terrence-malone/) |

## Deployed Product 
- [Front End](https://main.d2v2y4y91pkwd.amplifyapp.com/) 
- [Back End](https://hrf-a-api.herokuapp.com/) 
- [DS](http://human-rights-first-ds-a.eba-yikxuxau.us-east-1.elasticbeanstalk.com/) 

## Project Repositories 
- [Front End](https://github.com/Lambda-School-Labs/human-rights-first-fe-a)
- [Back End](https://github.com/Lambda-School-Labs/human-rights-first-be-a/tree/main)
- [DS](https://github.com/Lambda-School-Labs/human-rights-first-ds-a)

## Getting Stated - Back End 
- We inherited a project that had been designed and implementated in a previous labs group. Their repository can be found [here](https://github.com/Lambda-School-Labs/human-rights-first-be-a/tree/730ec3207aef416d626c582c24c8c74c39890db2).

- [Product Roadmap](https://www.notion.so/Human-Rights-First-Roadmap-Labs-28-4725bc357588498587902fed9d9b78c5)

- There is an installation instructions file for installing all dependcies and getting docker set up


## Tech Stack
- Database 
  - postgres 
  - knex 

- API
  - language used
    - JavaScript
      - express
  - documentation
    - swagger docs
  - loggers
    - helmet
    - morgan
  - utility 
    - axios
    - dotenv

### dependencies
    @okta/jwt-verifier: ^1.0.0
    axios: ^0.19.2
    cookie-parser: ~1.4.4
    cors: ^2.8.5
    debug: ~2.6.9
    dotenv: ^8.2.0
    express: ^4.16.4
    faker": ^4.1.0
    helmet": ^3.23.1
    http-errors: ~1.6.3
    knex: ^0.21.6
    knex-cleaner: ^1.3.1
    morgan: ~1.9.1
    node-cron: ^2.0.3
    pg: ^8.2.1
    swagger-jsdoc: ^4.0.0
    swagger-ui-express: ^4.1.4

  
## User Flow
[User Flow](https://camo.githubusercontent.com/4ec523c72040be7aaa7728f91749104654d752d55c153c720c8ba73e653bd4a4/68747470733a2f2f692e6962622e636f2f587431737738312f48756d616e2d5269676874732d46697273742d312d3235782e706e67)

## Architecture 
- [Technical Architecture](https://whimsical.com/hrf-architecture-JmcmB2Q6VCU3rsLCQGrXAu)
- File hierarchy
  - .github/workflows folder
    - used by previous team to implement code climate and test runs
    - commented out since our team didn't implement code climate since it was out of date 
  - __ tests __/routes folder 
    - inherited from previous team which holds their tests 
    - I implemented unit tests as well as end-to-end tests and put those files in the folders of the components they were testing 
  - api folder
    - app.js file is the file for the server set up
    - server.test.js file tests all the endpoints on the main route (/incidents)
    - dsService folder
      - inherited from previous team so not sure what it was for
      - looks like it was the datascience prediction files but our data science team worked on their own repo so these files weren't implemented
    - filter folder
      - front end wanted a route to filter the data coming from the database 
      - created new route for the filter so if future implementations needed more filters they would have their own route to use
      - test file contains test for the database model functions 
    - incidents folder
      - main route used to retrieve data for front end 
      - constants folder
        - incidentConstants file contains an array where you can look up the state abbreviation from the state name (used inside incidents route)
        - testConstants is the sample incidents I used to test the database table incidents 
      - middleware folder
        - originally inherited from previous team which would be used as middleware on the endpoints
        - during development ended up creating middleware functions to use inside other functions instead of endpoint middleware
      - test file contains test for the database table incidents 
    - index folder
      - inherited from previous team and holds base 'Hello World' route for '/' endpoint
    - middleware folder
      - inherited from previous team and looks like it would be used for authentication purposes of each user 
    - profile folder
      - inherited from previous team and looks like it is routes for user profiles
    - sources folder
      - contains functions to manipulate data from the database table sources 
      - test file contains test for the database table sources
    - tags folder
      - contains functions to manipulate data from the database table type_of_force
      - test file contains test for the database table type_of_force
  - config folder
    - inherited from previous team
    - jsdoc.js is the document to make changes to the overall swagger docs structure 
  - data folder 
    - contains the migrations, seeds and database config files
      - seeds were inherited from previous team and weren't used 
    - csvtojson file was trying to import a csv data file and change it to json since we were only importing the data once
        - does work but heroku won't let you run the file in their terminal so couldn't add it to the deployed database 
    - pdadmin folder
      - inherited folder from previous team so not sure what it's for exactly
      - based on the file contained inside I think it's to set up the postgres database 
  - docker/pg
    - inherited from previous team
  - INSTALLATION_INSTRUCTIONS.md
    - inherited from previous team and detail how to install and get the database up and running with postgres and docker 
    - no changes were made to set up so should work going forward
  - .env.sample
    - gives a sample for how the .env file should be structured 
    - Lambda provides the OKTA_URL_ISSUER and OKTA_CLIENT_ID for the developer
  - docker-compose.yml
    - file for docker to set up the postgres database properly
    - username and password for local database access can be found in this file 

## Updates To Repo in Labs 28 
- Updated database schema needed from previous implementation
  - [Database Schema](https://whimsical.com/human-rights-first-DZVHBA6A5pAnSE6BPUxeTR)
- Added unit tests for each database table implemented
- Added end-to-end tests for incident route endpoints 
- Added testing for duplicates of the incidents received from the DS API so duplicate incidents aren't added to the database
- Added filter end point for front end to get the count of each type of force in the database
  - create new filter route which could have more filters added to it in the future
- Separated table functions (sources, tags) from one file (incidentsModel.js) into separate files and folders relating to their table 
  - allow for cleaner, easier to read code as well as keeping the codebase modular
- Added function to validate incidents being received from DS API to make sure they are in the proper format 
- Implemented pagination for /showallincidents endpoint in the incidents route for front end use 
- Implemented process sources function to make sure each source object has an appropiate source url and type before being added into the database
- Commented out code that was implementing code climate 
  - didn't remove in case future teams wanted to implement it
- Updated swagger documentation for incidents route 

## End Points
- previous team did not implement foreign keys due to postgres and docker conflicts. Instead just manually added/edited/deleted the ids that connected each table which can be found [here](https://whimsical.com/human-rights-first-DZVHBA6A5pAnSE6BPUxeTR)

### incidents table

| Name         | Type       | Required | Description                                          |
| ------------ | ---------- | -------- | ---------------------------------------------------- |
| incident_id  | Increments | Yes      | unique identifier                                    |
| city         | String     | Yes      | gives the city the incident took place               |
| state        | String     | Yes      | gives the state the incident took place              |
| state_abbrev | String     | Yes      | state abbreviation                                   |
| lat          | Float      | Yes      | gives the latitude of the incident on the world map  |
| long         | Float      | Yes      | gives the longitude of the incident on the world map |
| title        | String     | Yes      | gives the title of the incident                      |
| desc         | Varchar    | No       | gives the description of the incident                |
| date         | Date       | No       | gives the date of the incident                       |

### sources table

| Name     | Type       | Required | Description               |
| -------- | ---------- | -------- | ------------------------- |
| src_id   | Increments | Yes      | unique identifier         |
| src_url  | String     | No       | gives url of the incident |
| src_type | String     | No       | gives url type            |

### type_of_force table

| Name             | Type       | Required | Description             |
| ---------------- | ---------- | -------- | ----------------------- |
| type_of_force_id | Increments | Yes      | unique identifier       |
| type_of_force    | String     | Yes      | gives type of force tag |

### incident_type_of_force table

| Name             | Type       | Required | Description                       |
| ---------------- | ---------- | -------- | --------------------------------- |
| itof_id          | Increments | Yes      | unique identifier                 |
| type_of_force_id | Integer    | Yes      | relates to specific type of force |
| incident_id      | Integer    | Yes      | relates to specific incident      |

### incident_sources

| Name        | Type       | Required | Description                  |
| ----------- | ---------- | -------- | ---------------------------- |
| is_id       | Increments | Yes      | unique identifier            |
| src_id      | Integer    | Yes      | relates to specific source   |
| incident_id | Integer    | Yes      | relates to specific incident |

#### Responses:

* API Docs can be found [here](https://hrf-a-api.herokuapp.com/api-docs/)

> GET /showallincidents Will receive a **200 (OK)** response with an array of incidents if the request is successful
> GET /showallincidents?limit=5&offset=0 Will receive a **200 (OK)** response with an array of 5 incidents offset by 0 if the request is successful

```javascript
[
  {
    incident_id: 'Test',
    city: 'test',
    state: 'test',
    state_abbrev: 'test',
    lat: 'test',
    long: 'test',
    title: 'test',
    desc: 'test',
    date: 'test',
    src: [
      {
        src_id: 'srcTest',
        src_type: 'typeTest',
        src_url: 'urlTest',
      },
    ],
    categories: [
      {
        type_of_force: 'force1',
        type_of_force_id: 'forceTest',
        incident_id: 'Test',
      },
    ],
  },
  {
    incident_id: 'Test2',
    city: 'test',
    state: 'test',
    state_abbrev: 'test',
    lat: 'test',
    long: 'test',
    title: 'test',
    desc: 'test',
    date: 'test',
    src: [
      {
        src_id: 'srcTest2',
        src_type: 'typeTest',
        src_url: 'urlTest2',
      },
    ],
    categories: [
      {
        type_of_force: 'force1',
        type_of_force_id: 'forceTest',
        incident_id: 'Test2',
      },
      {
        type_of_force: 'force2',
        type_of_force_id: 'forceTest2',
        incident_id: 'Test2',
      },
    ],
  },
];
```

> Will receive a **500 (Internal Server Error)** response if there is an issue with grabing the data

```javascript
{
  "err": "Request Error",
  "message": "Could not retrieve incidents from database"
}
```

---

> POST /createincidents Will receive a **201 (Created)** response along wtih the newly created incident if successful

```javascript
[
  {
    incident_id: 'Test',
    city: 'test',
    state: 'test',
    state_abbrev: 'test',
    lat: 'test',
    long: 'test',
    title: 'test',
    desc: 'test',
    date: 'test',
    src: [
      {
        src_id: 'srcTest',
        src_type: 'typeTest',
        src_url: 'urlTest',
      },
    ],
    categories: [
      {
        type_of_force: 'force1',
        type_of_force_id: 'forceTest',
        incident_id: 'Test',
      },
    ],
  },
];
```

> Will receive a **500 (Internal Server Error)** response if there is an issue with the API server

```javascript
{
    "err": "Request error",
    "message": "Error creating incident"
}
```

---

> GET /sources Will receive a **200 (OK)** response with an array of sources if the request is successful

```javascript
[
  {
    src_id: 'Test',
    incident_id: 'Test',
    src_url: 'test',
    src_type: 'test',
  },
  {
    src_id: 'Test',
    incident_id: 'Test',
    src_url: 'test',
    src_type: 'test',
  },
  {
    src_id: 'Test',
    incident_id: 'Test',
    src_url: 'test',
    src_type: 'test',
  },
];
```

> Will receive a **500 (Internal Server Error)** response if there is an issue with grabing the data

```javascript
{
  "err": "Request error",
  "message": "Error getting sources"
}
```

---

> GET /sources/:id Will receive a **200 (OK)** response with an array of sources for the given incident id if the request is successful

```javascript
[
  {
    src_id: 'Test',
    src_url: 'test',
    src_type: 'test',
  },
  {
    src_id: 'Test',
    src_url: 'test',
  },
];
```

> Will receive a **500 (Internal Server Error)** response if there is an issue with grabing the data

```javascript
{
  "err": "Request error",
  "message": "Error getting sources"
}
```

---

> POST /createsource Will receive a **201 (Created)** response along wtih the newly created source id if successful

```javascript
  {
    "src_id": "Test",
  },

```

> Will receive a **500 (Internal Server Error)** response if there is an issue with the API server

```javascript
{
    "err": "Request error",
    "message": "Error creating source"
}
```

---

> GET /tags Will receive a **200 (OK)** response with an array of tags if the request is successful

```javascript
[
  {
    type_of_force_id: 'Test',
    type_of_force: 'Test',
    incident_id: 'test',
  },
  {
    type_of_force_id: 'Test',
    type_of_force: 'Test',
    incident_id: 'test',
  },
  {
    type_of_force_id: 'Test',
    type_of_force: 'Test',
    incident_id: 'test',
  },
];
```

> Will receive a **500 (Internal Server Error)** response if there is an issue with grabing the data

```javascript
{
  "err": "Request error",
  "message": "Error getting types of force"
}
```

---

> GET /tags/:incidentID Will receive a **200 (OK)** response with an array of types of force for the given incident id if the request is successful

```javascript
[
  {
    type_of_force_id: 'test',
    type_of_force: 'test',
    incident_id: 'test',
  },
  {
    type_of_force_id: 'test',
    type_of_force: 'test',
    incident_id: 'test',
  },
  {
    type_of_force_id: 'test',
    type_of_force: 'test',
    incident_id: 'test',
  },
];
```

> Will receive a **500 (Internal Server Error)** response if there is an issue with grabing the data

```javascript
{
  "err": "Request error",
  "message": "Error getting types of force for incident id"
}
```

---

> GET /fetchfromds Will receive a **200 (OK)** response with an array of data received from DS API

```javascript
[
  {
    incident_id: Test,
    city: Test,
    state: Test,
    lat: Test,
    long: Test,
    title: Test,
    desc: Test,
    date: Test,
    categories: [Test, Test2, Test3],
    src: [{ src_id: Test, src_url: Test, src_type: Test }],
  },
];
```

> Will return **500 (Internal server error)** if there is a problem getting the data

```javascript
{
  "err": "Request error",
  "message": "Error data from DS API"

}

```

---

> GET /filter Will receive a **200 (OK)** response with an array of types of force with their associated count

```javascript
[
  {
    count: 255,
    type_of_force: 'Test',
  },
  {
    count: 255,
    type_of_force: 'Test',
  },
];
```

> Will receive a **500 (Internal Server error)** response if there is an issue with the API server

```javascript
  {
    "err": "Request error",
    "message": "Could not retrieve counts of different forces from database"
  }
```

---

## Issues
- Endpoints for a user to add an incident or source do not have verification middleware of the format of the incident or source object to be added. 
  - should add this middleware to make sure that if a user enters a wrong format it can let the user know and doesn't crash the application

## Future Features
- Add a function to pull data from DS API automatically every 24 hours or every 7 days (depending on amount of changed data in the DS API)
  - /fetchfromds endpoint can fetch the data and add to the database already it just doesn't have a timer functionality to pull it automatically
- Have a route for user profiles (implemented by previous group) but no table in database for user profile information
  - if the product wants users to log in to save preferences or searches would habe to add to the current database schema for the user information
  - need to review the previous team route/endpoints and tests to make sure they are comprehensive
- Add more filter endpoints to filter data for front end visualizations 

## Support 
You can reach all contributors on Lambda School's slack or through the github/linked in links above.
- You can contact me,  [Jessica](https://www.linkedin.com/in/jessicaduell/) for backend support
- You can contact [Maryam](https://www.linkedin.com/in/maryammosstoufi/), [Antonio](https://www.linkedin.com/in/antoniomtzb/) or [Ashley](https://www.linkedin.com/in/ashleybergsma89/) regarding the front end application support 
- You can contact [Ben](https://www.linkedin.com/in/benjamin-witter-a8980a50/) or [Terrance](https://www.linkedin.com/in/terrence-malone/) for Data Science support 
- Any questions or comments about the product as a whole or what features should be implemented contact our Team Lead ([Jean Fraga](https://www.linkedin.com/in/jeanfraga/))


